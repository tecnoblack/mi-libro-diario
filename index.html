<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; padding: 20px; }
        .libro-diario-container { max-width: 1000px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Encabezado Editable con Borde Azul */
        .header-box { border: 2px solid #3b82f6; text-align: center; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .editable:hover { background-color: #f0f7ff; cursor: pointer; border-radius: 3px; }
        .header-box h1 { margin: 0; font-size: 1.6rem; color: #1a1a1a; outline: none; }
        .header-box p { margin: 5px 0; font-weight: bold; font-size: 0.9rem; outline: none; }
        .header-box h2 { margin: 10px 0 0 0; text-decoration: underline; font-size: 1.2rem; outline: none; }

        .registro-info { margin-bottom: 20px; }
        .input-descripcion { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }

        /* Tabla Completa: FECHA | CUENTA | REF | DÉBITO | CRÉDITO */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #2563eb; color: white; padding: 12px; text-align: left; font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #e5e7eb; }

        .input-tabla { width: 100%; border: none; background: transparent; outline: none; font-size: 0.95rem; }
        .input-tabla:focus { border-bottom: 1px solid #3b82f6; }
        
        .btn-add { background-color: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 15px; }
        .btn-save { background-color: #3b82f6; color: white; border: none; padding: 15px; width: 100%; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 25px; font-size: 1rem; }
        
        .total-row { font-weight: bold; background-color: #f9fafb; font-size: 1.1rem; }
        .status-msg { font-size: 0.9rem; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="libro-diario-container">
    <div class="header-box">
        <h1 contenteditable="true" class="editable">COMERCIAL A B C, C.A.</h1>
        <p contenteditable="true" class="editable">RIF: J-00000000-0</p>
        <h2 contenteditable="true" class="editable">LIBRO DIARIO</h2>
        <p contenteditable="true" class="editable">PERÍODO: FEBRERO 2026</p>
    </div>

    <div class="registro-info">
        <label><b>Registro de Asiento</b></label>
        <input type="text" id="glosa" class="input-descripcion" placeholder="Escriba aquí la descripción del asiento (ej. Venta al Contado)...">
    </div>

    <button class="btn-add" onclick="agregarFila()">+ Añadir Cuenta</button>

    <table>
        <thead>
            <tr>
                <th style="width: 12%;">FECHA</th>
                <th style="width: 38%;">CUENTA</th>
                <th style="width: 10%;">REF</th>
                <th style="width: 20%;">DÉBITO</th>
                <th style="width: 20%;">CRÉDITO</th>
            </tr>
        </thead>
        <tbody id="cuerpo-asiento"></tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="3" style="text-align: right; padding-right: 20px;">TOTALES:</td>
                <td id="total-debito">0.00</td>
                <td id="total-credito">0.00</td>
            </tr>
        </tfoot>
    </table>

    <div id="mensaje-estado" class="status-msg"></div>
    <button class="btn-save">Guardar Asiento en Sistema</button>
</div>

<script>
    const IVA_TASA = 0.16;

    function obtenerFechaHoy() {
        const hoy = new Date();
        return `${String(hoy.getDate()).padStart(2, '0')}/${String(hoy.getMonth() + 1).padStart(2, '0')}/${hoy.getFullYear()}`;
    }

    function agregarFila(nombre = "", ref = "", debito = 0, credito = 0) {
        const tbody = document.getElementById('cuerpo-asiento');
        const esPrimera = tbody.rows.length === 0;
        const nuevaFila = tbody.insertRow();

        nuevaFila.innerHTML = `
            <td><input type="text" class="input-tabla" value="${esPrimera ? obtenerFechaHoy() : ''}" readonly></td>
            <td><input type="text" class="input-tabla" value="${nombre}" placeholder="Nombre de cuenta"></td>
            <td><input type="text" class="input-tabla" value="${ref}" placeholder="0"></td>
            <td><input type="number" class="input-tabla v-debito" value="${debito}" step="0.01" oninput="validarIVA(this)"></td>
            <td><input type="number" class="input-tabla v-credito" value="${credito}" step="0.01" oninput="calcularTotales()"></td>
        `;
        calcularTotales();
    }

    // Lógica de IVA Automático al escribir en la primera fila (Débito)
    function validarIVA(elemento) {
        const tbody = document.getElementById('cuerpo-asiento');
        const monto = parseFloat(elemento.value);

        // Si es la primera fila y no hay más filas creadas, generamos el desglose
        if (tbody.rows.length === 1 && monto > 0) {
            const baseImponible = monto / (1 + IVA_TASA);
            const iva = monto - baseImponible;

            // Añadimos las filas de contrapartida automáticas
            agregarFila("Venta", "2", 0, baseImponible.toFixed(2));
            agregarFila("Débito Fiscal", "3", 0, iva.toFixed(2));
        }
        calcularTotales();
    }

    function calcularTotales() {
        let debitoTotal = 0;
        let creditoTotal = 0;

        document.querySelectorAll('.v-debito').forEach(i => debitoTotal += parseFloat(i.value || 0));
        document.querySelectorAll('.v-credito').forEach(i => creditoTotal += parseFloat(i.value || 0));

        document.getElementById('total-debito').innerText = debitoTotal.toFixed(2);
        document.getElementById('total-credito').innerText = creditoTotal.toFixed(2);

        const msg = document.getElementById('mensaje-estado');
        if (debitoTotal.toFixed(2) === creditoTotal.toFixed(2) && debitoTotal > 0) {
            msg.innerText = "✓ Asiento cuadrado correctamente.";
            msg.style.color = "#059669";
        } else {
            msg.innerText = "⚠ El asiento no cuadra (Débito ≠ Crédito).";
            msg.style.color = "#dc2626";
        }
    }

    // Al cargar, inicializamos con la cuenta principal
    window.onload = () => {
        agregarFila("Caja", "1");
    };
</script>

</body>
</html>
